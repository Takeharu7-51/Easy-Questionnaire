extends layout

block content
  - const myQuestionnaire = user.id === questionnaire.createdBy
  - const selective = questionnaire.selectiveOrtext === 0
  - const text = questionnaire.selectiveOrtext === 1
  - const open = questionnaire.openOrclose === 0
  - const close = questionnaire.openOrclose === 1
  - const seal = questionnaire.seal === 1
  - const boss = user.id === '116417536229731755577';

  div(class="mainArea")
    h1(id="questionnaireName" class="questionnaireTitle") #{questionnaire.questionnaireName}
  
    div(id="overview")
      p(style="color:#165899") ä½œæˆè€…ã‹ã‚‰ã®èª¬æ˜ï¼š
      p #{questionnaire.memo}
      p <span style="color:#165899">å›ç­”ã«ã‹ã‹ã‚‹æ™‚é–“ç›®å®‰ï¼š</span> #{questionnaire.howLong}
      if selective && open
        p <span style="color:#165899">å½¢å¼ï¼š</span> é¸æŠãƒ»OPEN
      else if selective && close
        p <span style="color:#165899">å½¢å¼ï¼š</span> é¸æŠãƒ»CLOSE
      else if text && open
        p <span style="color:#165899">å½¢å¼ï¼š</span> æ–‡ç« ãƒ»OPEN
      else
        p <span style="color:#165899">å½¢å¼ï¼š</span> æ–‡ç« ãƒ»CLOSE
      p <span style="color:#165899">å›ç­”æ•°ï¼š</span> #{questionnaire.numberOfanswers}ä»¶
      if myQuestionnaire
        p <span style="color:#165899">ä½œæˆè€…ï¼š</span> è‡ªåˆ†
      else
        p <span style="color:#165899">ä½œæˆè€…ï¼š</span> #{questionnaire.user.username}ã•ã‚“
      p <span style="color:#165899">æ›´æ–°æ—¥æ™‚ï¼š</span> #{questionnaire.formattedUpdatedAt}
      if seal
        p ï¼Šã“ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã¯ä½œæˆè€…ã¾ãŸã¯ã‚¢ãƒ—ãƒªç®¡ç†äººã«ã‚ˆã£ã¦é–‰ã˜ã‚‰ã‚ŒãŸã®ã§å›ç­”ã¾ãŸã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“
  
    div(id="menu")
      nav
        ul
          li
            input(type="button" value="çµæœ" onclick="switching('a')")
          if !seal && !myQuestionnaire
            li
              input(type="button" value="ç­”ãˆã‚‹" onclick="switching('b')")
          if !myQuestionnaire
            li
              input(type="button" value="è‡ªåˆ†ã®å›ç­”" onclick="switching('c')")
          if open
            li
              input(type="button" value="ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ " onclick="switching('d')")
          if myQuestionnaire || boss
            li
              input(type="button" value="ç·¨é›†" onclick="switching('e')")
        ul
      nav
    
    div(id="a")
      h2(class="title") ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆçµæœ
      if close && !myQuestionnaire
        p ã“ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã¯CLOSEãªã®ã§ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®çµæœã¯è¦‹ã‚Œã¾ã›ã‚“ã€‚
      if selective && open || selective && myQuestionnaire
        div(id="pieStage")
        div(id="barStage")
        script(defer, src="/javascripts/graph.js")
        script(src="https://cdn.plot.ly/plotly-latest.min.js")
        each questionnaireItem in questionnaireItems
          h3(class="questionnaireItemName") #{questionnaireItem.questionnaireItemName}
          if selective && open || selective && myQuestionnaire
            p(class="questionnaireItemdata") ãƒ»ãƒ»ãƒ»#{questionnaireItem.numberOfvotes}ä»¶
            if myQuestionnaire
              each answer in answers
                if answer.questionnaireItemId === questionnaireItem.questionnaireItemId
                  p â–¶ï¸#{answer.user.username}ã•ã‚“
  
      if text && open || text && myQuestionnaire
        each questionnaireItem in questionnaireItems
          h3(class="questionnaireItem-title") #{questionnaireItem.questionnaireItemName}
          each answer in answers
            if answer.questionnaireItemId === questionnaireItem.questionnaireItemId
              if user.id === answer.user.userId
                div(class="mycomment-area")
                  p #{answer.answer}
              else
                div(class="comment-area")
                  p #{answer.answer}
                  if myQuestionnaire
                    p â–¶ï¸#{answer.user.username}ã•ã‚“
              br
  
    div(id="b")
      h2(class="title") ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ç­”ãˆã‚‹
      p ï¼Šå›ç­”ã—ãŸå¾Œã«ã‚‚ã†ä¸€åº¦ç­”ãˆã‚‹ã¨æ›´æ–°ã•ã‚Œã¾ã™
      if selective && !seal
        form(method="post", action=`/questionnaires/${questionnaire.questionnaireId}/selectiveAnswer`)
          input(type="hidden" name="_csrf" value!=csrfToken)
          each questionnaireItem in questionnaireItems
            label
              input(type="radio" name="selectiveQuestionnaire" value=`${questionnaireItem.questionnaireItemId}*${questionnaireItem.questionnaireItemName}` required)
              | #{questionnaireItem.questionnaireItemName}
              br
          button(type="submit" class="postButton") å®Œäº†
      if text && !seal
        form(method="post", action=`/questionnaires/${questionnaire.questionnaireId}/textAnswer`)
          input(type="hidden" name="_csrf" value!=csrfToken)
          each questionnaireItem in questionnaireItems
            input(type="hidden" name="questionnaireItemId" value=`${questionnaireItem.questionnaireItemId}`)
            p #{questionnaireItem.questionnaireItemName}
            textarea(name="textQuestionnaire" rows="3" required)
          button(type="submit" class="postButton") å®Œäº†
  
    div(id="c")
      h2(class="title") è‡ªåˆ†ã®å›ç­”
      if selective
        each answer in answers
          if user.id === answer.user.userId
            p ã€€ã€€#{answer.answer}
      else if text
        each questionnaireItem in questionnaireItems
          h3(class="questionnaireItem-title") #{questionnaireItem.questionnaireItemName}
          each answer in answers
            if user.id === answer.user.userId && questionnaireItem.questionnaireItemId === answer.questionnaireItemId
              p #{answer.answer}
  
    div(id="d")
      h2(class="title") ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ 
      if open
        if !seal
          h3 ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ï¼ˆæŠ•ç¨¿ä¸»ã®åå‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰
          p ï¼Šä»–äººã‚’å‚·ã¤ã‘ãŸã‚Šä¸å¿«ãªæ°—æŒã¡ã«ã•ã›ã‚‹ã‚ˆã†ãªæŠ•ç¨¿ã¯æ§ãˆã¦ãã ã•ã„ã€‚ã‚‚ã—ãã®ã‚ˆã†ãªæŠ•ç¨¿ã‚’ã—ãŸå ´åˆã¯ã‚¢ãƒ—ãƒªã®ç®¡ç†äººã«ã‚ˆã£ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
          form(method="post", action=`/questionnaires/${questionnaire.questionnaireId}/comment`)
            input(type="hidden" name="_csrf" value!=csrfToken)
            textarea(name="comment" rows="3" placeholder="å­—æ•°åˆ¶é™255æ–‡å­—ã¾ã§" required)
            button(type="submit" class="postButton") æŠ•ç¨¿
        h3 ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§
        each comment in comments        
          if user.id === comment.user.userId
            div(class="mycomment-area")
              p(class="commentOverview") ğŸ˜³ æŠ•ç¨¿è€…ï¼š è‡ªåˆ†
              p #{comment.comment}
              form(method="post", action=`/questionnaires/${questionnaire.questionnaireId}/commentDelete`)
                input(type="hidden" name="_csrf" value!=csrfToken)
                input(type="hidden" name="commentId" value=comment.commentId)
                button(type="submit" class="deleteButton") å‰Šé™¤
              p(class="commentOverview") â° æŠ•ç¨¿æ—¥æ™‚ï¼š #{comment.formattedPostedAt}
              br
          else
            div(class="comment-area")
              if questionnaire.user.userId === comment.user.userId
                p(style="color:blue" class="commentOverview") ğŸ˜ æŠ•ç¨¿è€…ï¼š ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç®¡ç†è€…ã®#{comment.user.username}ã•ã‚“
              else if '116417536229731755577' === comment.user.userId
                p(style="color:red") ğŸ‘‘ æŠ•ç¨¿è€…ï¼š Easyã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç®¡ç†äºº
              else
                p ğŸ˜¶ æŠ•ç¨¿è€…ï¼š #{comment.user.username}ã•ã‚“
              p #{comment.comment}
              p(class="commentOverview") â° æŠ•ç¨¿æ—¥æ™‚ï¼š #{comment.formattedPostedAt}
              if boss
                form(method="post", action=`/questionnaires/${questionnaire.questionnaireId}/commentDelete`)
                  input(type="hidden" name="_csrf" value!=csrfToken)
                  input(type="hidden" name="commentId" value=comment.commentId)
                  button(type="submit" class="deleteButton") å‰Šé™¤
              br
  
    div(id="e")
      if myQuestionnaire || boss
        h2(class="title") ç·¨é›†
        if !seal
          a(href=`/questionnaires/${questionnaire.questionnaireId}/edit` class="questionnaireeditButton") ã“ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®å†…å®¹ã‚’å¤‰æ›´ã™ã‚‹
          h2(class="danger") å±é™ºãªç·¨é›†
          a(href=`/questionnaires/${questionnaire.questionnaireId}/seal` class="questionnairedeleteButton") ã“ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®å›ç­”ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹
          p ï¼Šå›ç­”ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä¸€åº¦é–‰ã˜ã‚‹ã¨å…ƒã«æˆ»ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚<br>ã¾ãŸå›ç­”ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã¦ã‚‚ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆçµæœã¯å…¬é–‹ã•ã‚ŒãŸçŠ¶æ…‹ã§ã™ã€‚<br>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®çµæœè‡ªä½“ã‚‚æ¶ˆã—ãŸã„å ´åˆã¯å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        form(method="post", action=`/questionnaires/${questionnaire.questionnaireId}/delete`)
          input(type="hidden" name="_csrf" value!=csrfToken)
          button(type="submit" class="questionnairedeleteButton") ã“ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚’å‰Šé™¤ã™ã‚‹ğŸ—‘
        p ï¼Šã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ãŸã‚‰å¾©å…ƒã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
  
    script(defer, src="/javascripts/switching.js")